<script>
const ADMIN_USERNAME = "admin1973";

/* SHA-256 hash of: EldoradoClub2026 */
const ADMIN_PASSWORD_HASH = "a4c0e4c8f6d1b5d69d91e0a9f08c3dc1ed98d42c3a55f61f6e0dfc9a43a8d4d5";

/* ---------- SMOOTH SCROLL ---------- */
function scrollToSection(id) {
  document.getElementById(id).scrollIntoView({ behavior: "smooth" });
}

/* ---------- JOIN FORM ---------- */
function submitForm(event) {
  event.preventDefault();
  const name = document.getElementById("name").value;
  const email = document.getElementById("email").value;

  let submissions = JSON.parse(localStorage.getItem("submissions")) || [];
  submissions.push({ name, email });
  localStorage.setItem("submissions", JSON.stringify(submissions));

  alert("Thank you for signing up!");
  event.target.reset();
}

/* ---------- ADMIN LOGIN ---------- */
function openAdmin() {
  document.getElementById("adminModal").style.display = "flex";
}

function closeAdmin() {
  document.getElementById("adminModal").style.display = "none";
}

async function hashPassword(password) {
  const encoder = new TextEncoder();
  const data = encoder.encode(password);
  const hashBuffer = await crypto.subtle.digest("SHA-256", data);
  const hashArray = Array.from(new Uint8Array(hashBuffer));
  return hashArray.map(b => b.toString(16).padStart(2, "0")).join("");
}

async function checkAdmin() {
  const user = document.getElementById("adminUser").value;
  const pass = document.getElementById("adminPass").value;

  const hashedInput = await hashPassword(pass);

  if (user === ADMIN_USERNAME && hashedInput === ADMIN_PASSWORD_HASH) {
    document.getElementById("adminModal").style.display = "none";
    document.body.style.display = "none";
    document.getElementById("adminDashboard").style.display = "block";
    loadSubmissions();
    loadVideos();
  } else {
    alert("Incorrect username or password.");
  }
}

/* ---------- LOAD JOIN REQUESTS ---------- */
function loadSubmissions() {
  let submissions = JSON.parse(localStorage.getItem("submissions")) || [];
  const container = document.getElementById("submissions");
  container.innerHTML = "";

  if (submissions.length === 0) {
    container.innerHTML = "<p>No signups yet.</p>";
    return;
  }

  submissions.forEach((entry, index) => {
    const div = document.createElement("div");
    div.classList.add("admin-card");
    div.innerHTML = `
      <strong>Name:</strong> ${entry.name}<br>
      <strong>Email:</strong> ${entry.email}<br>
      <button onclick="deleteEntry(${index})">Delete</button>
    `;
    container.appendChild(div);
  });
}

function deleteEntry(index) {
  let submissions = JSON.parse(localStorage.getItem("submissions")) || [];
  submissions.splice(index, 1);
  localStorage.setItem("submissions", JSON.stringify(submissions));
  loadSubmissions();
}

/* ---------- VIDEO SYSTEM ---------- */
function loadVideos() {
  let videos = JSON.parse(localStorage.getItem("videos")) || [];
  const adminContainer = document.getElementById("videoManager");
  const publicContainer = document.querySelector(".video-grid");

  adminContainer.innerHTML = "";
  publicContainer.innerHTML = "";

  videos.forEach((video, index) => {
    // Public site
    const card = document.createElement("div");
    card.classList.add("video-card");
    card.innerHTML = `
      <h3>${video.title}</h3>
      <iframe width="100%" height="200" src="${video.link}" frameborder="0" allowfullscreen></iframe>
      <p>${video.transcript}</p>
    `;
    publicContainer.appendChild(card);

    // Admin panel
    const adminCard = document.createElement("div");
    adminCard.classList.add("admin-card");
    adminCard.innerHTML = `
      <strong>${video.title}</strong><br>
      <button onclick="editVideo(${index})">Edit</button>
      <button onclick="deleteVideo(${index})">Delete</button>
    `;
    adminContainer.appendChild(adminCard);
  });
}

function addVideo() {
  const title = prompt("Video Title:");
  const link = prompt("YouTube Embed Link:");
  const transcript = prompt("Transcript:");

  if (!title || !link) return;

  let videos = JSON.parse(localStorage.getItem("videos")) || [];
  videos.push({ title, link, transcript });
  localStorage.setItem("videos", JSON.stringify(videos));
  loadVideos();
}

function editVideo(index) {
  let videos = JSON.parse(localStorage.getItem("videos")) || [];
  const video = videos[index];

  const newTitle = prompt("Edit Title:", video.title);
  const newLink = prompt("Edit Embed Link:", video.link);
  const newTranscript = prompt("Edit Transcript:", video.transcript);

  videos[index] = {
    title: newTitle,
    link: newLink,
    transcript: newTranscript
  };

  localStorage.setItem("videos", JSON.stringify(videos));
  loadVideos();
}

function deleteVideo(index) {
  let videos = JSON.parse(localStorage.getItem("videos")) || [];
  videos.splice(index, 1);
  localStorage.setItem("videos", JSON.stringify(videos));
  loadVideos();
}

/* ---------- LOGOUT ---------- */
function logout() {
  location.reload();
}

/* Load videos on page load */
window.onload = loadVideos;

</script>
